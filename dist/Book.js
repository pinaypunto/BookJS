(function(){var a,b,c,d;window.Transformer=d=function(){var a,b,c,d,e,f,g;return b=["translateX","translateY","translateZ","rotateX","rotateY","rotateZ","scale"],e=function(a){var b,c,d,e,f,g,h;for(c=[],f=0,g=a.length;g>f;f++){d=a[f],h=d.object;for(b in h)e=h[b],-1===c.indexOf(b)&&c.push(b)}return c},g=function(a){return a.sort(function(a,b){return a.percent<b.percent?-1:1}),a},f=function(a){return 0===a.indexOf("rotate")?"deg":0===a.indexOf("scale")?"":"px"},d=function(a,b,c){var d,e,f,g,h,i,j;for(f=null,e=null,d=null,i=0,j=c.length;j>i;i++)if(g=c[i],null!=g.object[a]){if(g.percent>=b){e={percent:g.percent,value:g.object[a]},f=d?{percent:d.percent,value:d.object[a]}:e;break}d=g}return h=(e.value-f.value)*(b-f.percent)/(e.percent-f.percent)+f.value,isNaN(h)?0:h},c=function(a,c){var d,e,g;e=[];for(d in c)g=c[d],-1===b.indexOf(d)?a.style[d]=g:e.push(""+d+"("+g+f(d)+")");return e.length?(a.style.webkitTransform=e.join(" "),a.style.MozTransform=e.join(" ")):void 0},a=function(){function a(a,b){return this.el=a,null==b&&(b={}),this.steps=[],this.initialized=!1,this}return a.prototype.init=function(){return this.steps=g(this.steps),this.all_properties=e(this.steps),this.initialized=!0},a.prototype.addStep=function(a,b){return this.initialized=!1,this.steps.push({percent:a,object:b}),this},a.prototype.set=function(a,b){var e,f,g,h,i,j;for(null==b&&(b=!1),this.initialized||this.init(),e={},j=this.all_properties,h=0,i=j.length;i>h;h++)f=j[h],g=d(f,a,this.steps),e[f]=g;return c(this.el,e),this},a}(),function(b){return new a(b)}}(),a=function(){var a,d;return d=function(){var a;return a=document.createElement("article"),a.className="book",a},a=function(){return this.container=null,this.pages=[],this.sides=[],this.index=-1,this},a.prototype={addDoublePage:function(a){var b;return b=this.pages.length,this.sides.push(c.createPageSide(a,!0)),this.sides.push(c.createPageSide(a,!0,!0)),this},addPage:function(a){return this.sides.push(c.createPageSide(a)),this},next:function(){var a;return a=this.pages.length,a>this.index+1?(this.index++,this.pages[this.index].toggle(!1),!0):!1},previous:function(){return this.index>-1?(this.pages[this.index].toggle(!0),this.index--,!0):!1},render:function(a){var e,f,g,h,i;for(this.element=d(),a.appendChild(this.element),i=Math.round(this.sides.length/2),g=0;g<this.sides.length;)f=this.sides[g],e=g+1<this.sides.length?this.sides[g+1]:null,h=c.create(f,e,this.pages.length,i),h.render(this.element),this.pages.push(h),g+=2;return b.init(this),this},currentPage:function(){return this.pages[this.index]}},{create:function(b){return new a(b||{})}}}(),window.Book=a,c=function(){var a,b,c,d,e;return b=function(a,b){return a.addEventListener("webkitTransitionEnd",b),a.addEventListener("transitionend",b)},e=function(a,b){return a.removeEventListener("webkitTransitionEnd",b),a.removeEventListener("transitionend",b)},c=function(a,b){var c;return c=document.createElement("section"),c.setAttribute("data-page-index",a+1+"/"+b),c.className="book-page",c.style.zIndex=-1*a,c},d=function(a){var b,c,f;return a.currentTarget.removeAttribute("style"),c=a.currentTarget.getAttribute("data-page-index").split("/"),b=c[0]-1,f=c[1]-1,a.currentTarget.style.zIndex=a.currentTarget.getAttribute("data-status")?-1*(f-b):-1*b,e(a.currentTarget,d),a.preventDefault(),a.stopPropagation()},a=function(a,b,d,e){return this.element=c(d,e),a.className="book-page-front",this.element.appendChild(a),b||(b=document.createElement("div")),b.className="book-page-back",this.element.appendChild(b),this},a.prototype={toggle:function(a){return null==a&&(a=!1),b(this.element,d),this.element.removeAttribute("style"),this.element.removeAttribute("book-page-noanim"),this.element.style.zIndex=1,a===!0?this.element.removeAttribute("data-status"):this.element.setAttribute("data-status","passed"),this},render:function(a){return a.appendChild(this.element)}},{create:function(b,c,d,e){return new a(b,c,d,e)},createPageSide:function(a,b,c){var d,e;return null==b&&(b=!1),null==c&&(c=!1),d=document.createElement("div"),b===!0?(d.setAttribute("data-page-type","double"),e=document.createElement("div"),e.innerHTML=a,d.appendChild(e),c===!0?(d.scrollLeft=999999,e.scrollLeft=999999):(d.scrollLeft=0,e.scrollLeft=0)):d.innerHTML=a,d}}}(),b=function(){var a,b,c,e,f,g,h,i,j,k,l,m,n,o;return b=50,a=.5,f=null,o=!1,g=0,n=0,e=function(a){var b,c;if(console.log(a),console.log("p1",a.parentNode),console.log("p2",a.parentNode.parentNode),console.log("p3",a.parentNode.parentNode.parentNode),"book-page"===a.className)return a;for(b=a,c=0;null!=b.parentNode&&c++<100;)if("book-page"===b.parentNode.className)return b.parentNode;return null},k=function(a){return d(a).addStep(0,{rotateY:0}).addStep(100,{rotateY:-180})},l=function(a){return d(a).addStep(0,{rotateY:-180}).addStep(100,{rotateY:0})},i=function(a){return a.pageX},m=function(){return function(a){o=!0,g=0,n=i(a),a.preventDefault(),a.stopPropagation(),f=e(a.target),f.style.zIndex=1}},j=function(){return function(a){var c;o&&f&&(g=i(a)-n,c=Math.max(Math.min(20*g/b,99),-99),f.setAttribute("book-page-noanim","true"),0>g&&!f.getAttribute("data-status")?k(f).set(Math.abs(c)):g>0&&f.getAttribute("data-status")&&l(f).set(Math.abs(c)),a.preventDefault(),a.stopPropagation())}},h=function(a){return function(){var c,d;o=!1,c=Math.abs(g),console.log(c),c>b?(d=g>0?"previous":"next",a[d]()):f&&(f.removeAttribute("book-page-noanim"),f.removeAttribute("style")),f=null,o=!1,g=0,n=0}},c=function(a){a.element.addEventListener("mousedown",m(a)),a.element.addEventListener("mousemove",j(a)),a.element.addEventListener("mouseup",h(a))},{init:c}}()}).call(this);